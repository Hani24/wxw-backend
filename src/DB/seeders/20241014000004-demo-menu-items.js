'use strict';

/**
 * Demo Menu Items Seeder
 * Creates menu items for each category
 */

module.exports = {
  up: async (queryInterface, Sequelize) => {
    const now = new Date();

    // Get categories with their restaurant IDs
    const categories = await queryInterface.sequelize.query(
      `SELECT mc.id, mc.name as categoryName, mc.restaurantId, r.name as restaurantName
       FROM MenuCategories mc
       JOIN Restaurants r ON mc.restaurantId = r.id
       ORDER BY mc.restaurantId, mc.order`,
      { type: queryInterface.sequelize.QueryTypes.SELECT }
    );

    // Helper function to find category by restaurant and category name
    const getCategoryId = (restaurantName, categoryName) => {
      const cat = categories.find(c => c.restaurantName === restaurantName && c.categoryName === categoryName);
      return cat ? cat.id : null;
    };

    const getRestaurantId = (restaurantName) => {
      const cat = categories.find(c => c.restaurantName === restaurantName);
      return cat ? cat.restaurantId : null;
    };

    const menuItems = [
      // Restaurant 1 - Delicious Burgers & More
      // Category: Burgers (categoryId: 1)
      {
        restaurantId: getRestaurantId("Delicious Burgers & More"),
        menuCategoryId: getCategoryId("Delicious Burgers & More", "Burgers"),
        name: 'Classic Cheeseburger',
        description: 'Juicy beef patty with American cheese, lettuce, tomato, onion, pickles',
        image: 'classic-cheeseburger.jpg',
        price: 8.99,
        kcal: 650,
        proteins: 28,
        fats: 35,
        carbs: 45,
        order: 1,
        isAvailable: true,
        rating: 4.5,
        createdAt: now,
        updatedAt: now,
      },
      {
        restaurantId: getRestaurantId("Delicious Burgers & More"),
        menuCategoryId: getCategoryId("Delicious Burgers & More", "Burgers"),
        name: 'Bacon Cheeseburger',
        description: 'Classic burger with crispy bacon strips',
        image: 'bacon-cheeseburger.jpg',
        price: 10.99,
        kcal: 780,
        proteins: 32,
        fats: 45,
        carbs: 48,
        order: 2,
        isAvailable: true,
        rating: 4.8,
        createdAt: now,
        updatedAt: now,
      },
      {
        restaurantId: getRestaurantId("Delicious Burgers & More"),
        menuCategoryId: getCategoryId("Delicious Burgers & More", "Burgers"),
        name: 'Mushroom Swiss Burger',
        description: 'Saut√©ed mushrooms with Swiss cheese',
        image: 'mushroom-swiss-burger.jpg',
        price: 11.49,
        kcal: 720,
        proteins: 30,
        fats: 40,
        carbs: 46,
        order: 3,
        isAvailable: true,
        rating: 4.6,
        createdAt: now,
        updatedAt: now,
      },
      {
        restaurantId: getRestaurantId("Delicious Burgers & More"),
        menuCategoryId: getCategoryId("Delicious Burgers & More", "Burgers"),
        name: 'Double Patty Deluxe',
        description: 'Two beef patties, double cheese, special sauce',
        image: 'double-patty.jpg',
        price: 13.99,
        kcal: 920,
        proteins: 48,
        fats: 55,
        carbs: 52,
        order: 4,
        isAvailable: true,
        rating: 4.9,
        createdAt: now,
        updatedAt: now,
      },

      // Category: Sides (categoryId: 2)
      {
        restaurantId: getRestaurantId("Delicious Burgers & More"),
        menuCategoryId: getCategoryId("Delicious Burgers & More", "Sides"),
        name: 'French Fries',
        description: 'Crispy golden fries with sea salt',
        image: 'french-fries.jpg',
        price: 3.99,
        kcal: 365,
        proteins: 4,
        fats: 17,
        carbs: 48,
        order: 1,
        isAvailable: true,
        rating: 4.4,
        createdAt: now,
        updatedAt: now,
      },
      {
        restaurantId: getRestaurantId("Delicious Burgers & More"),
        menuCategoryId: getCategoryId("Delicious Burgers & More", "Sides"),
        name: 'Onion Rings',
        description: 'Beer-battered onion rings',
        image: 'onion-rings.jpg',
        price: 4.99,
        kcal: 410,
        proteins: 5,
        fats: 20,
        carbs: 52,
        order: 2,
        isAvailable: true,
        rating: 4.5,
        createdAt: now,
        updatedAt: now,
      },

      // Category: Drinks (categoryId: 3)
      {
        restaurantId: getRestaurantId("Delicious Burgers & More"),
        menuCategoryId: getCategoryId("Delicious Burgers & More", "Drinks"),
        name: 'Soft Drink',
        description: 'Choice of Coke, Sprite, or Fanta',
        image: 'soft-drink.jpg',
        price: 2.49,
        kcal: 150,
        proteins: 0,
        fats: 0,
        carbs: 39,
        order: 1,
        isAvailable: true,
        rating: 4.0,
        createdAt: now,
        updatedAt: now,
      },
      {
        restaurantId: getRestaurantId("Delicious Burgers & More"),
        menuCategoryId: getCategoryId("Delicious Burgers & More", "Drinks"),
        name: 'Milkshake',
        description: 'Vanilla, chocolate, or strawberry',
        image: 'milkshake.jpg',
        price: 4.99,
        kcal: 420,
        proteins: 8,
        fats: 12,
        carbs: 68,
        order: 2,
        isAvailable: true,
        rating: 4.7,
        createdAt: now,
        updatedAt: now,
      },

      // Restaurant 2 - Italian Pizza House
      // Category: Classic Pizzas (categoryId: 5)
      {
        restaurantId: getRestaurantId("Italian Pizza House"),
        menuCategoryId: getCategoryId("Italian Pizza House", "Classic Pizzas"),
        name: 'Margherita Pizza',
        description: 'Fresh mozzarella, tomato sauce, basil',
        image: 'margherita-pizza.jpg',
        price: 12.99,
        kcal: 800,
        proteins: 35,
        fats: 28,
        carbs: 95,
        order: 1,
        isAvailable: true,
        rating: 4.8,
        createdAt: now,
        updatedAt: now,
      },
      {
        restaurantId: getRestaurantId("Italian Pizza House"),
        menuCategoryId: getCategoryId("Italian Pizza House", "Classic Pizzas"),
        name: 'Pepperoni Pizza',
        description: 'Classic pepperoni with mozzarella',
        image: 'pepperoni-pizza.jpg',
        price: 14.99,
        kcal: 920,
        proteins: 38,
        fats: 35,
        carbs: 98,
        order: 2,
        isAvailable: true,
        rating: 4.9,
        createdAt: now,
        updatedAt: now,
      },
      {
        restaurantId: getRestaurantId("Italian Pizza House"),
        menuCategoryId: getCategoryId("Italian Pizza House", "Classic Pizzas"),
        name: 'Four Cheese Pizza',
        description: 'Mozzarella, parmesan, gorgonzola, fontina',
        image: 'four-cheese-pizza.jpg',
        price: 15.99,
        kcal: 950,
        proteins: 42,
        fats: 38,
        carbs: 96,
        order: 3,
        isAvailable: true,
        rating: 4.7,
        createdAt: now,
        updatedAt: now,
      },

      // Category: Specialty Pizzas (categoryId: 6)
      {
        restaurantId: getRestaurantId("Italian Pizza House"),
        menuCategoryId: getCategoryId("Italian Pizza House", "Specialty Pizzas"),
        name: 'BBQ Chicken Pizza',
        description: 'BBQ sauce, grilled chicken, red onions, cilantro',
        image: 'bbq-chicken-pizza.jpg',
        price: 16.99,
        kcal: 880,
        proteins: 45,
        fats: 32,
        carbs: 94,
        order: 1,
        isAvailable: true,
        rating: 4.8,
        createdAt: now,
        updatedAt: now,
      },
      {
        restaurantId: getRestaurantId("Italian Pizza House"),
        menuCategoryId: getCategoryId("Italian Pizza House", "Specialty Pizzas"),
        name: 'Meat Lovers Pizza',
        description: 'Pepperoni, sausage, bacon, ham, beef',
        image: 'meat-lovers-pizza.jpg',
        price: 17.99,
        kcal: 1050,
        proteins: 52,
        fats: 48,
        carbs: 98,
        order: 2,
        isAvailable: true,
        rating: 4.9,
        createdAt: now,
        updatedAt: now,
      },

      // Category: Pasta (categoryId: 7)
      {
        restaurantId: getRestaurantId("Italian Pizza House"),
        menuCategoryId: getCategoryId("Italian Pizza House", "Pasta"),
        name: 'Spaghetti Carbonara',
        description: 'Eggs, pancetta, pecorino cheese, black pepper',
        image: 'carbonara.jpg',
        price: 13.99,
        kcal: 720,
        proteins: 28,
        fats: 32,
        carbs: 75,
        order: 1,
        isAvailable: true,
        rating: 4.7,
        createdAt: now,
        updatedAt: now,
      },
      {
        restaurantId: getRestaurantId("Italian Pizza House"),
        menuCategoryId: getCategoryId("Italian Pizza House", "Pasta"),
        name: 'Fettuccine Alfredo',
        description: 'Creamy parmesan sauce',
        image: 'alfredo.jpg',
        price: 12.99,
        kcal: 680,
        proteins: 24,
        fats: 35,
        carbs: 72,
        order: 2,
        isAvailable: true,
        rating: 4.6,
        createdAt: now,
        updatedAt: now,
      },

      // Restaurant 3 - Tokyo Sushi & Asian Fusion
      // Category: Sushi Rolls (categoryId: 9)
      {
        restaurantId: getRestaurantId("Tokyo Sushi & Asian Fusion"),
        menuCategoryId: getCategoryId("Tokyo Sushi & Asian Fusion", "Sushi Rolls"),
        name: 'California Roll',
        description: 'Crab, avocado, cucumber',
        image: 'california-roll.jpg',
        price: 8.99,
        kcal: 255,
        proteins: 9,
        fats: 7,
        carbs: 38,
        order: 1,
        isAvailable: true,
        rating: 4.5,
        createdAt: now,
        updatedAt: now,
      },
      {
        restaurantId: getRestaurantId("Tokyo Sushi & Asian Fusion"),
        menuCategoryId: getCategoryId("Tokyo Sushi & Asian Fusion", "Sushi Rolls"),
        name: 'Spicy Tuna Roll',
        description: 'Fresh tuna with spicy mayo',
        image: 'spicy-tuna-roll.jpg',
        price: 10.99,
        kcal: 290,
        proteins: 12,
        fats: 9,
        carbs: 36,
        order: 2,
        isAvailable: true,
        rating: 4.8,
        createdAt: now,
        updatedAt: now,
      },
      {
        restaurantId: getRestaurantId("Tokyo Sushi & Asian Fusion"),
        menuCategoryId: getCategoryId("Tokyo Sushi & Asian Fusion", "Sushi Rolls"),
        name: 'Dragon Roll',
        description: 'Eel, cucumber, avocado on top',
        image: 'dragon-roll.jpg',
        price: 14.99,
        kcal: 420,
        proteins: 18,
        fats: 12,
        carbs: 58,
        order: 3,
        isAvailable: true,
        rating: 4.9,
        createdAt: now,
        updatedAt: now,
      },
      {
        restaurantId: getRestaurantId("Tokyo Sushi & Asian Fusion"),
        menuCategoryId: getCategoryId("Tokyo Sushi & Asian Fusion", "Sushi Rolls"),
        name: 'Rainbow Roll',
        description: 'California roll topped with assorted fish',
        image: 'rainbow-roll.jpg',
        price: 15.99,
        kcal: 380,
        proteins: 22,
        fats: 10,
        carbs: 52,
        order: 4,
        isAvailable: true,
        rating: 4.9,
        createdAt: now,
        updatedAt: now,
      },

      // Category: Sashimi (categoryId: 10)
      {
        restaurantId: getRestaurantId("Tokyo Sushi & Asian Fusion"),
        menuCategoryId: getCategoryId("Tokyo Sushi & Asian Fusion", "Sashimi"),
        name: 'Salmon Sashimi',
        description: '6 pieces of fresh salmon',
        image: 'salmon-sashimi.jpg',
        price: 12.99,
        kcal: 210,
        proteins: 24,
        fats: 12,
        carbs: 0,
        order: 1,
        isAvailable: true,
        rating: 4.8,
        createdAt: now,
        updatedAt: now,
      },
      {
        restaurantId: getRestaurantId("Tokyo Sushi & Asian Fusion"),
        menuCategoryId: getCategoryId("Tokyo Sushi & Asian Fusion", "Sashimi"),
        name: 'Tuna Sashimi',
        description: '6 pieces of fresh tuna',
        image: 'tuna-sashimi.jpg',
        price: 13.99,
        kcal: 184,
        proteins: 26,
        fats: 8,
        carbs: 0,
        order: 2,
        isAvailable: true,
        rating: 4.9,
        createdAt: now,
        updatedAt: now,
      },

      // Category: Hot Dishes (categoryId: 11)
      {
        restaurantId: getRestaurantId("Tokyo Sushi & Asian Fusion"),
        menuCategoryId: getCategoryId("Tokyo Sushi & Asian Fusion", "Hot Dishes"),
        name: 'Chicken Teriyaki',
        description: 'Grilled chicken with teriyaki sauce, rice',
        image: 'chicken-teriyaki.jpg',
        price: 14.99,
        kcal: 620,
        proteins: 42,
        fats: 18,
        carbs: 72,
        order: 1,
        isAvailable: true,
        rating: 4.7,
        createdAt: now,
        updatedAt: now,
      },
      {
        restaurantId: getRestaurantId("Tokyo Sushi & Asian Fusion"),
        menuCategoryId: getCategoryId("Tokyo Sushi & Asian Fusion", "Hot Dishes"),
        name: 'Beef Ramen',
        description: 'Rich beef broth, noodles, egg, vegetables',
        image: 'beef-ramen.jpg',
        price: 13.99,
        kcal: 580,
        proteins: 35,
        fats: 22,
        carbs: 65,
        order: 2,
        isAvailable: true,
        rating: 4.8,
        createdAt: now,
        updatedAt: now,
      },

      // Restaurant 4 - El Loco Taco Truck
      // Category: Tacos (categoryId: 13)
      {
        restaurantId: getRestaurantId("El Loco Taco Truck"),
        menuCategoryId: getCategoryId("El Loco Taco Truck", "Tacos"),
        name: 'Carne Asada Taco',
        description: 'Grilled steak, onions, cilantro, lime',
        image: 'carne-asada-taco.jpg',
        price: 3.99,
        kcal: 210,
        proteins: 12,
        fats: 8,
        carbs: 22,
        order: 1,
        isAvailable: true,
        rating: 4.8,
        createdAt: now,
        updatedAt: now,
      },
      {
        restaurantId: getRestaurantId("El Loco Taco Truck"),
        menuCategoryId: getCategoryId("El Loco Taco Truck", "Tacos"),
        name: 'Al Pastor Taco',
        description: 'Marinated pork, pineapple, onions, cilantro',
        image: 'al-pastor-taco.jpg',
        price: 3.99,
        kcal: 220,
        proteins: 11,
        fats: 9,
        carbs: 24,
        order: 2,
        isAvailable: true,
        rating: 4.9,
        createdAt: now,
        updatedAt: now,
      },
      {
        restaurantId: getRestaurantId("El Loco Taco Truck"),
        menuCategoryId: getCategoryId("El Loco Taco Truck", "Tacos"),
        name: 'Fish Taco',
        description: 'Beer-battered fish, cabbage, chipotle mayo',
        image: 'fish-taco.jpg',
        price: 4.49,
        kcal: 240,
        proteins: 14,
        fats: 10,
        carbs: 26,
        order: 3,
        isAvailable: true,
        rating: 4.7,
        createdAt: now,
        updatedAt: now,
      },

      // Category: Burritos (categoryId: 14)
      {
        restaurantId: getRestaurantId("El Loco Taco Truck"),
        menuCategoryId: getCategoryId("El Loco Taco Truck", "Burritos"),
        name: 'Super Burrito',
        description: 'Rice, beans, meat, cheese, sour cream, guacamole',
        image: 'super-burrito.jpg',
        price: 9.99,
        kcal: 820,
        proteins: 38,
        fats: 32,
        carbs: 95,
        order: 1,
        isAvailable: true,
        rating: 4.8,
        createdAt: now,
        updatedAt: now,
      },
      {
        restaurantId: getRestaurantId("El Loco Taco Truck"),
        menuCategoryId: getCategoryId("El Loco Taco Truck", "Burritos"),
        name: 'Breakfast Burrito',
        description: 'Eggs, bacon, potatoes, cheese',
        image: 'breakfast-burrito.jpg',
        price: 8.99,
        kcal: 720,
        proteins: 32,
        fats: 28,
        carbs: 82,
        order: 2,
        isAvailable: true,
        rating: 4.7,
        createdAt: now,
        updatedAt: now,
      },

      // Category: Quesadillas (categoryId: 15)
      {
        restaurantId: getRestaurantId("El Loco Taco Truck"),
        menuCategoryId: getCategoryId("El Loco Taco Truck", "Quesadillas"),
        name: 'Cheese Quesadilla',
        description: 'Melted cheese in a crispy tortilla',
        image: 'cheese-quesadilla.jpg',
        price: 6.99,
        kcal: 480,
        proteins: 22,
        fats: 24,
        carbs: 45,
        order: 1,
        isAvailable: true,
        rating: 4.5,
        createdAt: now,
        updatedAt: now,
      },
      {
        restaurantId: getRestaurantId("El Loco Taco Truck"),
        menuCategoryId: getCategoryId("El Loco Taco Truck", "Quesadillas"),
        name: 'Chicken Quesadilla',
        description: 'Grilled chicken and cheese',
        image: 'chicken-quesadilla.jpg',
        price: 8.99,
        kcal: 580,
        proteins: 32,
        fats: 26,
        carbs: 48,
        order: 2,
        isAvailable: true,
        rating: 4.7,
        createdAt: now,
        updatedAt: now,
      },

      // Category: Extras (categoryId: 16)
      {
        restaurantId: getRestaurantId("El Loco Taco Truck"),
        menuCategoryId: getCategoryId("El Loco Taco Truck", "Extras"),
        name: 'Chips & Guacamole',
        description: 'Fresh tortilla chips with homemade guac',
        image: 'chips-guacamole.jpg',
        price: 5.99,
        kcal: 320,
        proteins: 4,
        fats: 18,
        carbs: 38,
        order: 1,
        isAvailable: true,
        rating: 4.6,
        createdAt: now,
        updatedAt: now,
      },
      {
        restaurantId: getRestaurantId("El Loco Taco Truck"),
        menuCategoryId: getCategoryId("El Loco Taco Truck", "Extras"),
        name: 'Horchata',
        description: 'Traditional rice milk drink',
        image: 'horchata.jpg',
        price: 3.49,
        kcal: 180,
        proteins: 2,
        fats: 4,
        carbs: 36,
        order: 2,
        isAvailable: true,
        rating: 4.8,
        createdAt: now,
        updatedAt: now,
      },
    ];

    await queryInterface.bulkInsert('MenuItems', menuItems, {});

    console.log('‚úÖ Demo menu items created successfully!');
    console.log('üçΩÔ∏è  34 menu items added across 4 restaurants');
    console.log('   - Delicious Burgers: 8 items');
    console.log('   - Italian Pizza: 8 items');
    console.log('   - Tokyo Sushi: 8 items');
    console.log('   - El Loco Taco: 10 items');
  },

  down: async (queryInterface, Sequelize) => {
    // Get restaurant IDs to delete their menu items
    const restaurants = await queryInterface.sequelize.query(
      `SELECT id FROM Restaurants WHERE name IN ('Delicious Burgers & More', 'Italian Pizza House', 'Tokyo Sushi & Asian Fusion', 'El Loco Taco Truck')`,
      { type: queryInterface.sequelize.QueryTypes.SELECT }
    );

    const restaurantIds = restaurants.map(r => r.id);

    await queryInterface.bulkDelete('MenuItems', {
      restaurantId: {
        [Sequelize.Op.in]: restaurantIds
      }
    }, {});

    console.log('‚úÖ Demo menu items removed successfully!');
  }
};
